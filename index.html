<!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>Visual Graph Algorithms</title>

<!-- d3 and Bootstrap/Jquery cuz I'm lazy -->
<script src="./support/jquery-1.11.3.min.js"></script>
<link rel="stylesheet" href="./support/bootstrap-3.3.4/css/bootstrap.min.css"></link>
<link rel="stylesheet" href="./support/bootstrap-3.3.4/css/bootstrap-theme.min.css"></link>
<script src="./support/bootstrap-3.3.4/js/bootstrap.min.js"></script>
<script src="./support/d3/d3.min.js"></script>

<!-- Launcher and utils -->
<script src="./coloring.js"></script>
<script src="./Graph.js"></script>
<script src="./Heap.js"></script>
<script src="./TreeDisplay.js"></script>
<script src="./FileSaver.js"

<!-- Algorithms -->
<script src="./DFS.js"></script>
<script src="./BFS.js"></script>
<script src="./Dijkstra.js"></script>
<script src="./Bellman-Ford.js"></script>
</head>

<!-- That style -->
<style>

circle {
  fill: #ccc;
  stroke: #fff;
  stroke-width: 0px;
}

text {
  font: 30px sans-serif;
  pointer-events: none;
}

.graph, .struct, .data-struct {
 display: inline-block;
 position: relative;
 width: 45%;
 padding-bottom: 10%;
 float: left;
 
 vertical-align: left;
}

.data-struct {
  width: 100%;
}

#error {
  width : 50%;
}


#svg-algo, #svg-data-struct {
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
}

</style>

<h1 id="page-title">Graph Algorithms by Andy Schmitt, UC Berkeley</h1>

<!-- Algorithm Setup Buttons -->
<div class="btn-toolbar" role="toolbar" aria-label="...">
  <div class="btn-group" role="group" aria-label="...">
  	<button onclick="setup(0, isDirected);" type="algo" class="btn btn-primary active">DFS</button>
  	<button onclick="setup(1, isDirected);" type="algo" class="btn btn-primary">BFS</button>
  </div>
  <div class="btn-group" role="group" aria-label="...">
  	<button onclick="setup(2, isDirected);" type="algo" class="btn btn-success">Dijkstra's</button>
  	<button onclick="setup(3, isDirected);" type="algo" class="btn btn-success">Bellman-Ford</button>
  </div>
  <div class="btn-group" role="group" aria-label="...">
  	<button onclick="setup(4, isDirected);" type="algo" class="btn btn-info">Kruskal's</button>
  	<button onclick="setup(5, isDirected);" type="algo" class="btn btn-info">Prim's</button>
  </div>
  <div class="btn-group" role="group" aria-label="...">
    <button onclick="download(algorithms[cur_algorithm])" type="download" class="btn btn-danger">Download Graph As Image</button>
  </div>
</div>

<br>

<!-- Directed and Undirected Buttons and Run button -->

<div class="btn-toolbar" role="toolbar" aria-label="...">
	<div class="btn-group" role="group" aria-label="...">
		<button onclick="isDirected = true; setup(cur_algorithm, isDirected);" type="direction" class="btn btn-warning">Directed</button>
		<button onclick="isDirected = false; setup(cur_algorithm, isDirected);" type="direction" class="btn btn-warning active">Un-Directed</button>
	</div>
  <div class="btn-group" role="group" aria-label="...">
    <button onclick="FLASH_INT = 300;" type="speed" class="btn btn-warning">Slow</button>
    <button onclick="FLASH_INT = 200" type="speed" class="btn btn-warning active">Medium</button>
    <button onclick="FLASH_INT = 100" type="speed" class="btn btn-warning">Fast</button>
    <button onclick="FLASH_INT = 50" type="speed" class="btn btn-warning">Very Fast</button>
  </div>
	<div class="btn-group" role="group" aria-label="...">
		<button onclick="run()" type="run" class="btn btn-danger">Run Algorithm!</button>
	</div>
  <div class="btn-group" role="group" aria-label="...">
    <button type="changeBackground" class="btn btn-primary">Change BackGround Color</button>
  </div>
</div>

<!-- controls buttons -->
<script>
$(".btn[type!=changeBackground]").on("click", function(event) {
  var elmType = $(this).attr("type");
  if (elmType != 'run' && elmType != 'download') {
    $(".btn[type="+elmType+"]").removeClass("active");
    $(this).addClass("active");
  }
  $(this).blur();   //don't want buttons to focus after selection
})

$(".btn[type=changeBackground]").on("click", function(event) {
  var dur = 400;
  var new_color = CUR_BACKGROUND_COLOR == "#000000" ? "#FFFFFF" : "#000000"; //Switch between black and white background
  var title_color = new_color == "#FFFFFF" ? "#000000" : "#0066FF"
  //color title
  d3.select("#page-title").transition()
    .style("color", title_color)
    .duration(dur);
  //color svg background
  d3.selectAll("svg").transition()
    .style("background", new_color)
    .duration(dur);
  //color body background
  d3.select("body").transition()
    .style("background-color", new_color)
    .duration(dur);
  //color all text
  var temp = CUR_BACKGROUND_COLOR;
  d3.selectAll("text").transition()
    .style("fill", temp) //text is opposite color of background
    .duration(dur);
  CUR_TEXT_COLOR = CUR_BACKGROUND_COLOR;
  CUR_BACKGROUND_COLOR = new_color;
  $(this).blur();
})

function download(fileName) {
    var svg = d3.select("#svg-algo"),
        html = svg
          .attr("version", 1.1)
          .attr("xmlns", "http://www.w3.org/2000/svg")
          .node().parentNode.innerHTML,

        canvasId = "sBqSmOcj-1932418";

    var imgsrc = 'data:image/svg+xml;base64,'+ btoa(unescape(encodeURIComponent(html)));

    var canvas;
    if (!document.getElementById(canvasId)) {

      canvas = document.createElement("canvas");
      canvas.id = canvasId;
      canvas.height = 800;
      canvas.width = 960;
      canvas.style.display = "none";
      document.body.appendChild(canvas);

    }

    canvas = document.getElementById(canvasId);
    var context = canvas.getContext("2d");

    var image = new Image;
    image.src = imgsrc;
    image.onload = function() {

        context.drawImage(image, 0, 0);

        var a = document.createElement("a");
        a.download = fileName + ".png";
        a.href = canvas.toDataURL("image/png");
        a.click();
    };
}
</script>

<br>

<!-- Display error/info messages here -->
<div id="error" class="alert alert-info">
  <h3> Choose one of the alogrithms above, along with its directedness, to build the graph. Then hit the run algorithm button. Remember that the MST algorithms, Kruskal's and Prim's, do not run on directed graphs. Feel free to drag the graph around however you want!</h3>
</div>

<!-- This is what we build the graph on. -->
<div class="graph"> 
</div>

<!-- Display data structures here -->
<div class="struct">
  <h3 id="data-struct-title"></h3>
  <div class="data-struct">
  </div>
</div>

</html>